language: node_js

node_js: 
    - 0.12

# build image
build_image: shippableimages/ubuntu1404_nodejs
env: 
  global:
    - SLACK_ORG=Ottemo Project=Dashboard
    - REMOTE_HOST=admin.blitz.ottemo.io FOUNDATION_URI=https://api.blitz.ottemo.io
    - secure: E5KMgEfDJ7QcMF4vEG3eiayrs+BUI/EQvrewOW66D3ZIy0cB5xZYrsSsft4TVxr3os+1geUmLMjL+g/O8Sg89o+yG5qlbdodOLBT9qRXjlGEAVh3dlJuTSOFV0t4hNIP8vBtdgitLKQwzg3QBmJRjjEh734vjjT7SnS6jXiCHb2s81H+QD0dZTnIgg3b3m2nbKpm5TfgCjI0t4810+zPU/L3uV7mWbX6s77iWlPafIlYgXZxY7hMViSavlbbLwTAr3T08iu7mB/3Ti2CxxI6MQB9jxFiFP9yvKKVmF9plmpjqzumZ/Pd3q6wxBdk6gkLmGWyDWM/mtpanp9zTW2DNQ==

before_install:
    # install NodeJS v0.12
    - source ~/.nvm/nvm.sh && nvm install $SHIPPABLE_NODE_VERSION
    - npm update -g npm 
    - npm version
    - npm install -g gulp

install: 
    # install the required dependencies
    - npm install
        
script: 
    - NODE_ENV=production gulp build
    # deploy if branch == 'develop'
    - bash deploy.sh

after_failure:
    - python slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN

after_success:
    - python slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN -s